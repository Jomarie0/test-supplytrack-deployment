{% extends "base_admin.html" %}
{% load static %}

{% block title %}Purchase Order - {{ po_number }}{% endblock %}

{% block content %}
<style>
/* Print-optimized styles matching PDF */
.po-wrapper {
    max-width: 800px;
    margin: 2rem auto;
    background: white;
    padding: 3rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

/* Header Section */
.po-main-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #ddd;
}

.po-title-section h1 {
    font-size: 2rem;
    font-weight: bold;
    color: #666;
    margin: 0 0 0.5rem 0;
    letter-spacing: 0.5px;
}

.po-title-section p {
    margin: 0;
    color: #666;
    font-size: 0.95rem;
}

.po-date-status {
    text-align: right;
}

.po-date-status p {
    margin: 0 0 0.5rem 0;
    color: #666;
    font-size: 0.9rem;
}

/* Supplier / Company Section */
.info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    margin-bottom: 2.5rem;
}

@media screen and (min-width: 769px) {
    .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr !important;
    }
}

.info-section h3 {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #999;
    margin-bottom: 1rem;
    font-weight: 700;
}

.info-section p {
    margin: 0.4rem 0;
    color: #333;
    font-size: 0.9rem;
    line-height: 1.6;
}

.info-section .supplier-name,
.info-section .company-name {
    font-weight: 700;
    color: #000;
    margin-bottom: 0.5rem;
}

.info-section i {
    width: 16px;
    color: #999;
    font-size: 0.85rem;
}

/* Status Badge */
.status-badge {
    display: inline-block;
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
    margin-top: 1rem;
}

.badge-draft {
    background: #f3f4f6;
    color: #6b7280;
}

.badge-request_pending {
    background: #fef3c7;
    color: #92400e;
}

.badge-supplier_priced {
    background: #dbeafe;
    color: #1e40af;
}

.badge-confirmed {
    background: #dcfce7;
    color: #166534;
}

.badge-in_transit {
    background: #e0e7ff;
    color: #4338ca;
}

.badge-received {
    background: #dcfce7;
    color: #166534;
}

.badge-cancelled {
    background: #fee2e2;
    color: #991b1b;
}

.badge-partially_received {
    background: #fef3c7;
    color: #92400e;
}

/* Product Details Section */
.product-section-title {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #999;
    margin: 2rem 0 1rem 0;
    font-weight: 700;
}

/* Items Table */
.items-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 2rem;
}

.items-table thead {
    border-bottom: 1px solid #ddd;
}

.items-table th {
    padding: 0.75rem 0;
    text-align: left;
    font-size: 0.85rem;
    font-weight: 700;
    color: #333;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.items-table tbody tr {
    border-bottom: 1px solid #eee;
}

.items-table td {
    padding: 1rem 0;
    color: #333;
    font-size: 0.9rem;
}

.product-name {
    font-weight: 600;
    color: #000;
    margin-bottom: 0.25rem;
}

.product-description {
    font-size: 0.8rem;
    color: #999;
}

/* Totals Section */
.totals-section {
    margin-top: 2rem;
    padding-top: 1rem;
}

.totals-row {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    font-size: 0.95rem;
}

.totals-row.subtotal,
.totals-row.tax {
    color: #666;
}

.totals-row.total {
    border-top: 2px solid #333;
    padding-top: 1rem;
    margin-top: 0.5rem;
    font-size: 1.1rem;
    font-weight: 700;
    color: #16a34a;
}

.totals-row .label {
    flex: 1;
}

.totals-row .amount {
    text-align: right;
    min-width: 120px;
}

/* Notes Section */
.notes-section {
    margin-top: 2rem;
    padding: 1.5rem;
    background: #f9fafb;
    border-radius: 8px;
    border-left: 4px solid #667eea;
}

.notes-section h4 {
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: #666;
    margin-bottom: 0.75rem;
    font-weight: 700;
}

.notes-section p {
    margin: 0;
    color: #333;
    font-size: 0.9rem;
    line-height: 1.6;
}

/* Footer */
.po-footer {
    margin-top: 3rem;
    padding-top: 1.5rem;
    border-top: 1px solid #ddd;
    text-align: center;
}

.po-footer p {
    margin: 0.5rem 0;
    font-size: 0.85rem;
}

.po-footer .thank-you {
    font-weight: 700;
    color: #333;
}

.po-footer .contact-info {
    color: #999;
    font-size: 0.8rem;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 2px solid #eee;
}

.btn-primary-custom {
    background: #667eea;
    color: white;
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
}

.btn-primary-custom:hover {
    background: #5568d3;
    color: white;
}

.btn-secondary-custom {
    background: white;
    color: #666;
    border: 1px solid #ddd;
    padding: 0.8rem 1.5rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
}

.btn-secondary-custom:hover {
    border-color: #667eea;
    color: #667eea;
}

/* Print Styles */
@media print {
    .action-buttons,
    .navbar,
    .sidebar,
    nav,
    .no-print {
        display: none !important;
    }
    
    .po-wrapper {
        box-shadow: none;
        margin: 0;
        padding: 1rem;
        max-width: 100%;
    }
    
    body {
        background: white;
    }
}

/* Responsive */
@media (max-width: 576px) {
    .info-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .po-wrapper {
        padding: 1.5rem;
        margin: 1rem;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .items-table {
        font-size: 0.8rem;
    }
}
</style>

<div class="po-wrapper">
    
    <!-- Purchase Order Header -->
    <div class="po-main-header">
        <div class="po-title-section">
            <h1>PURCHASE ORDER</h1>
            <p>PO #{{ po_number }}</p>
        </div>
        <div class="po-date-status">
            <p><strong>Date:</strong> {{ order_date|date:"F d, Y" }}</p>
            <p><strong>Status:</strong> {{ status }}</p>
        </div>
    </div>

    <!-- Supplier / Company Information -->
    <div class="info-grid">
        <!-- Supplier -->
        <div class="info-section">
            <h3>üì¶ SUPPLIER</h3>
            <p class="supplier-name">{{ supplier_name }}</p>
            <p><i class="fas fa-map-marker-alt"></i> {{ supplier_address }}</p>
            {% if supplier_email != 'N/A' %}
            <p><i class="fas fa-envelope"></i> {{ supplier_email }}</p>
            {% endif %}
            {% if supplier_phone != 'N/A' %}
            <p><i class="fas fa-phone"></i> {{ supplier_phone }}</p>
            {% endif %}
        </div>

        <!-- Company -->
        <div class="info-section">
            <h3>üè¢ FROM</h3>
            <p class="company-name">Your Company Name</p>
            <p><i class="fas fa-map-marker-alt"></i> 123 Business Street, City, Philippines</p>
            <p><i class="fas fa-phone"></i> +63 (123) 456-7890</p>
            <p><i class="fas fa-envelope"></i> purchasing@yourcompany.com</p>
            
            <span class="status-badge badge-{{ purchase_order.status }}">
                {{ status }}
            </span>
        </div>
    </div>

    <!-- Order Details -->
    <div class="info-grid">
        <div class="info-section">
            <h3>üìÖ DELIVERY INFORMATION</h3>
            {% if expected_delivery_date %}
            <p><strong>Expected Delivery:</strong> {{ expected_delivery_date|date:"F d, Y" }}</p>
            {% else %}
            <p><strong>Expected Delivery:</strong> To be determined</p>
            {% endif %}
            <p><strong>Payment Method:</strong> {{ payment_method }}</p>
        </div>
        
        <div class="info-section">
            <h3>üë§ CREATED BY</h3>
            <p><strong>Staff:</strong> {{ created_by }}</p>
            <p><strong>Date Created:</strong> {{ order_date|date:"F d, Y" }}</p>
        </div>
    </div>

    <!-- Product Details -->
    <h3 class="product-section-title">ORDER ITEMS</h3>

    <!-- Order Items Table -->
    <table class="items-table">
        <thead>
            <tr>
                <th style="width: 40%;">Product</th>
                <th style="width: 25%;">Description</th>
                <th style="width: 12%; text-align: center;">Qty Ordered</th>
                <th style="width: 12%; text-align: right;">Unit Cost</th>
                <th style="width: 11%; text-align: right;">Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>
                    <div class="product-name">
                        {% if item.product_variant %}
                            {{ item.product_variant.product.name }}
                        {% elif item.product %}
                            {{ item.product.name }}
                        {% else %}
                            {{ item.product_name_text }}
                        {% endif %}
                    </div>
                </td>
                <td>
                    <div class="product-description">
                        {% if item.description %}
                            {{ item.description }}
                        {% else %}
                            -
                        {% endif %}
                    </div>
                </td>
                <td style="text-align: center; font-weight: 600;">{{ item.quantity_ordered }}</td>
                <td style="text-align: right;">
                    {% if item.unit_cost %}
                        ‚Ç±{{ item.unit_cost|floatformat:2 }}
                    {% else %}
                        <span style="color: #999;">Pending</span>
                    {% endif %}
                </td>
                <td style="text-align: right; font-weight: 600;">
                    {% if item.unit_cost %}
                        ‚Ç±{{ item.total_price|floatformat:2 }}
                    {% else %}
                        <span style="color: #999;">-</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" style="text-align: center; color: #999; padding: 2rem 0;">
                    No items found in this purchase order.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Totals Section -->
    <div class="totals-section">
        <div class="totals-row subtotal">
            <span class="label">Subtotal:</span>
            <span class="amount">‚Ç±{{ subtotal|floatformat:2 }}</span>
        </div>
        
        <div class="totals-row tax">
            <span class="label">Tax ({% if tax > 0 %}12%{% else %}0%{% endif %}):</span>
            <span class="amount">‚Ç±{{ tax|floatformat:2 }}</span>
        </div>
        
        <div class="totals-row total">
            <span class="label">TOTAL AMOUNT:</span>
            <span class="amount">‚Ç±{{ total|floatformat:2 }}</span>
        </div>
    </div>

    <!-- Notes Section -->
    {% if notes %}
    <div class="notes-section">
        <h4>üìù Notes</h4>
        <p>{{ notes }}</p>
    </div>
    {% endif %}

    <!-- Footer -->
    <div class="po-footer">
        <p class="thank-you">Thank you for your partnership!</p>
        <p class="contact-info">For questions, contact us at purchasing@yourcompany.com or +63 (123) 456-7890</p>
        <p class="contact-info">Purchase Order generated on {{ order_date|date:"F d, Y" }}</p>
    </div>

    <!-- Action Buttons (hidden in print) -->
    <div class="action-buttons no-print">
        <button onclick="window.print()" class="btn-primary-custom">
            <i class="fas fa-print"></i>
            Print PO
        </button>
        
        <a href="{% url 'PO:purchase_order_pdf' purchase_order.purchase_order_id %}" 
           class="btn-primary-custom" 
           target="_blank">
            <i class="fas fa-download"></i>
            Download PDF
        </a>
        
        <a href="{% url 'PO:po_billing_dashboard' %}" class="btn-secondary-custom">
            <i class="fas fa-arrow-left"></i>
            Back to PO dashboard
        </a>
    </div>

</div>

{% endblock %}