{% extends "base_admin.html" %}
{% load static %}

{% block title %}Invoice - {{ order_number }}{% endblock %}

{% block content %}
<style>
/* Print-optimized styles matching PDF */
.invoice-wrapper {
    max-width: 800px;
    margin: 2rem auto;
    background: white;
    padding: 3rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

/* Header Section */
.invoice-main-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid #ddd;
}

.invoice-title-section h1 {
    font-size: 2rem;
    font-weight: bold;
    color: #666;
    margin: 0 0 0.5rem 0;
    letter-spacing: 0.5px;
}

.invoice-title-section p {
    margin: 0;
    color: #666;
    font-size: 0.95rem;
}

.invoice-date-status {
    text-align: right;
}

.invoice-date-status p {
    margin: 0 0 0.5rem 0;
    color: #666;
    font-size: 0.9rem;
}

/* Bill To / From Section */
.info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    margin-bottom: 2.5rem;
}

@media screen and (min-width: 769px) {
    .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr !important;
    }
}

.info-section h3 {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #999;
    margin-bottom: 1rem;
    font-weight: 700;
}

.info-section p {
    margin: 0.4rem 0;
    color: #333;
    font-size: 0.9rem;
    line-height: 1.6;
}

.info-section .customer-name,
.info-section .company-name {
    font-weight: 700;
    color: #000;
    margin-bottom: 0.5rem;
}

.info-section i {
    width: 16px;
    color: #999;
    font-size: 0.85rem;
}

/* Status Badges */
.status-badges {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
}

.status-badge {
    padding: 0.4rem 0.8rem;
    border-radius: 4px;
    font-size: 0.8rem;
    font-weight: 600;
}

.badge-paid {
    background: #dcfce7;
    color: #166534;
}

.badge-unpaid {
    background: #fef3c7;
    color: #92400e;
}

.badge-completed {
    background: #dcfce7;
    color: #166534;
}

.badge-processing {
    background: #dbeafe;
    color: #1e40af;
}

.badge-pending {
    background: #fef3c7;
    color: #92400e;
}

/* Product Details Section */
.product-section-title {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #999;
    margin: 2rem 0 1rem 0;
    font-weight: 700;
}

/* Items Table */
.items-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 2rem;
}

.items-table thead {
    border-bottom: 1px solid #ddd;
}

.items-table th {
    padding: 0.75rem 0;
    text-align: left;
    font-size: 0.85rem;
    font-weight: 700;
    color: #333;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.items-table tbody tr {
    border-bottom: 1px solid #eee;
}

.items-table td {
    padding: 1rem 0;
    color: #333;
    font-size: 0.9rem;
}

.product-name {
    font-weight: 600;
    color: #000;
    margin-bottom: 0.25rem;
}

.product-variant {
    font-size: 0.8rem;
    color: #999;
}

/* Totals Section */
.totals-section {
    margin-top: 2rem;
    padding-top: 1rem;
}

.totals-row {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    font-size: 0.95rem;
}

.totals-row.subtotal,
.totals-row.tax {
    color: #666;
}

.totals-row.total {
    border-top: 2px solid #333;
    padding-top: 1rem;
    margin-top: 0.5rem;
    font-size: 1.1rem;
    font-weight: 700;
    color: #16a34a;
}

.totals-row .label {
    flex: 1;
}

.totals-row .amount {
    text-align: right;
    min-width: 120px;
}

/* Footer */
.invoice-footer {
    margin-top: 3rem;
    padding-top: 1.5rem;
    border-top: 1px solid #ddd;
    text-align: center;
}

.invoice-footer p {
    margin: 0.5rem 0;
    font-size: 0.85rem;
}

.invoice-footer .thank-you {
    font-weight: 700;
    color: #333;
}

.invoice-footer .contact-info {
    color: #999;
    font-size: 0.8rem;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    padding-top: 2rem;
    border-top: 2px solid #eee;
}

.btn-primary-custom {
    background: #667eea;
    color: white;
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
}

.btn-primary-custom:hover {
    background: #5568d3;
    color: white;
}

.btn-secondary-custom {
    background: white;
    color: #666;
    border: 1px solid #ddd;
    padding: 0.8rem 1.5rem;
    border-radius: 6px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
}

.btn-secondary-custom:hover {
    border-color: #667eea;
    color: #667eea;
}

/* Print Styles */
@media print {
    .action-buttons,
    .navbar,
    .sidebar,
    nav,
    .no-print {
        display: none !important;
    }
    
    .invoice-wrapper {
        box-shadow: none;
        margin: 0;
        padding: 1rem;
        max-width: 100%;
    }
    
    body {
        background: white;
    }
}

/* Responsive */
@media (max-width: 576px) {
    .info-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .invoice-wrapper {
        padding: 1.5rem;
        margin: 1rem;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .items-table {
        font-size: 0.8rem;
    }
}
</style>

<div class="invoice-wrapper">
    
    <!-- Invoice Header -->
    <div class="invoice-main-header">
        <div class="invoice-title-section">
            <h1>INVOICE</h1>
            <p>Order #{{ order_number }}</p>
        </div>
        <div class="invoice-date-status">
            <p><strong>Date:</strong> {{ order_date|date:"F d, Y" }}</p>
            <p><strong>Status:</strong> {{ payment_status|title }}</p>
        </div>
    </div>

    <!-- Bill To / From Information -->
    <div class="info-grid">
        <!-- Bill To -->
        <div class="info-section">
            <h3>üìã BILL TO</h3>
            <p class="customer-name">{{ customer_name }}</p>
            <p><i class="fas fa-map-marker-alt"></i> {{ shipping_address }}</p>
            {% if customer_email %}
            <p><i class="fas fa-envelope"></i> {{ customer_email }}</p>
            {% endif %}
            {% if customer_phone %}
            <p><i class="fas fa-phone"></i> {{ customer_phone }}</p>
            {% endif %}
        </div>

        <!-- From -->
        <div class="info-section">
            <h3>üè¢ FROM</h3>
            <p class="company-name">Your Company Name</p>
            <p><i class="fas fa-map-marker-alt"></i> 123 Business Street, City, Philippines</p>
            <p><i class="fas fa-phone"></i> +63 (123) 456-7890</p>
            <p><i class="fas fa-envelope"></i> billing@yourcompany.com</p>
            
            <div class="status-badges">
                {% if payment_status == 'paid' %}
                    <span class="status-badge badge-paid">‚úÖ Paid</span>
                {% else %}
                    <span class="status-badge badge-unpaid">‚è≥ Unpaid</span>
                {% endif %}
                
                {% if order_status == 'Completed' %}
                    <span class="status-badge badge-completed">‚úì Completed</span>
                {% elif order_status == 'Processing' %}
                    <span class="status-badge badge-processing">‚öôÔ∏è Processing</span>
                {% elif order_status == 'Pending' %}
                    <span class="status-badge badge-pending">‚è≥ Pending</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Product Details -->
    <h3 class="product-section-title">ORDER DETAILS</h3>

    <!-- Order Items Table -->
    <table class="items-table">
        <thead>
            <tr>
                <th style="width: 50%;">Description</th>
                <th style="width: 12%; text-align: center;">Qty</th>
                <th style="width: 19%; text-align: right;">Unit Price</th>
                <th style="width: 19%; text-align: right;">Amount</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>
                    <div class="product-name">{{ item.product_variant.product.name }}</div>
                    {% if item.product_variant.sku and item.product_variant.sku != 'DEFAULT' %}
                    <div class="product-variant">SKU: {{ item.product_variant.sku }}</div>
                    {% endif %}
                </td>
                <td style="text-align: center; font-weight: 600;">{{ item.quantity }}</td>
                <td style="text-align: right;">‚Ç±{{ item.price_at_order|floatformat:2 }}</td>
                <td style="text-align: right; font-weight: 600;">‚Ç±{{ item.item_total|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" style="text-align: center; color: #999; padding: 2rem 0;">
                    No items found in this order.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Totals Section -->
    <div class="totals-section">
        <div class="totals-row subtotal">
            <span class="label">Subtotal:</span>
            <span class="amount">‚Ç±{{ subtotal|floatformat:2 }}</span>
        </div>
        
        <div class="totals-row tax">
            <span class="label">Tax ({% if tax > 0 %}12%{% else %}0%{% endif %}):</span>
            <span class="amount">‚Ç±{{ tax|floatformat:2 }}</span>
        </div>
        
        <div class="totals-row total">
            <span class="label">TOTAL AMOUNT:</span>
            <span class="amount">‚Ç±{{ total|floatformat:2 }}</span>
        </div>
    </div>

    <!-- Footer -->
    <div class="invoice-footer">
        <p class="thank-you">Thank you for your business!</p>
        <p class="contact-info">For questions, contact us at billing@yourcompany.com or +63 (123) 456-7890</p>
        <p class="contact-info">Invoice generated on {{ order_date|date:"F d, Y" }}</p>
    </div>

    <!-- Action Buttons (hidden in print) -->
    <div class="action-buttons no-print">
        <button onclick="window.print()" class="btn-primary-custom">
            <i class="fas fa-print"></i>
            Print Invoice
        </button>
        
        <a href="{% url 'orders:customer_invoice_pdf' order.id order_type %}" 
           class="btn-primary-custom" 
           target="_blank">
            <i class="fas fa-download"></i>
            Download PDF
        </a>
        
        <a href="{% url 'orders:billing_dashboard' %}" class="btn-secondary-custom">
            <i class="fas fa-arrow-left"></i>
            Back to Dashboard
        </a>
    </div>

</div>

{% endblock %}