{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>{% block title %}Supplier | Panel{% endblock %}</title>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="{% static 'css/base/base_admin/base_admin.css' %}">
    {% block styles %}{% endblock %}
</head>
<body class="relative">

    <!-- Sidebar Toggle Button -->
    <button class="btn-toggle fixed top-4 left-4 z-50 bg-indigo-600 text-white p-2 rounded-md shadow"
            onclick="toggleSidebar()">☰</button>

    <!-- SIDEBAR -->
    <aside id="sidebar" class="sidebar bg-white shadow-sm" aria-label="Main Sidebar Navigation">
        <nav class="sidebar-nav">
            <div class="sidebar-brand px-5 py-4 font-bold text-lg border-b border-gray-200">
                SupplyTrack Supplier
            </div>

            <ul class="menu p-4 space-y-2">
                <li>
                    <a href="{% url 'suppliers:supplier_dashboard' %}"
                       class="menu-item {% if request.resolver_match.url_name == 'supplier_dashboard' %}active{% endif %} flex items-center gap-3 p-2 rounded hover:bg-gray-100">
                        <i class="fas fa-home"></i> Dashboard
                    </a>
                </li>
                <li>
                    <a href="{% url 'suppliers:supplier_order_list' %}"
                       class="menu-item {% if request.resolver_match.url_name == 'supplier_order_list' %}active{% endif %} flex items-center gap-3 p-2 rounded hover:bg-gray-100">
                        <i class="fas fa-boxes"></i> Orders
                    </a>
                </li>
            </ul>
        </nav>

        <div class="sidebar-footer bg-white border-t border-gray-200 p-3">
            <button id="sidebarProfileBtn"
                    class="w-full flex items-center justify-between gap-3 p-2 hover:bg-gray-100 rounded-lg transition"
                    onclick="openProfileModal()">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500
                                flex items-center justify-center text-white font-semibold text-lg flex-shrink-0">
                        {{ request.user.first_name|default:request.user.username|slice:":1"|upper }}
                    </div>
                    <div class="flex flex-col text-left overflow-hidden">
                        <span class="font-medium text-sm text-gray-900 truncate">{{ request.user.get_full_name|default:request.user.username }}</span>
                        <span class="text-xs text-gray-500">Supplier</span>
                    </div>
                </div>
                <i class="fas fa-chevron-up text-gray-500 text-xs"></i>
            </button>
        </div>
    </aside>

    <!-- PROFILE MODAL -->
    <div id="profileModal"
         class="hidden fixed inset-0 z-[1200] bg-black bg-opacity-50 flex items-end sm:items-center justify-start"
         onclick="closeProfileModal()">
        <div class="bg-white rounded-lg shadow-2xl transform transition-all w-64 mx-4 mb-20 sm:mb-0 p-5 relative"
             onclick="event.stopPropagation()">

            <div class="text-center border-b border-gray-100 pb-3 mb-3">
                <div class="w-16 h-16 mx-auto rounded-full bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center text-white font-bold text-2xl mb-2">
                    {{ request.user.first_name|default:request.user.username|slice:":1"|upper }}
                </div>
                <p class="font-semibold text-gray-900">{{ request.user.get_full_name|default:request.user.username }}</p>
                <p class="text-sm text-gray-500 truncate">{{ request.user.email|default:request.user.username }}</p>
                <p class="text-xs text-indigo-600 mt-1">Supplier</p>
            </div>

            <div class="space-y-2">
                <button id="logoutBtn"
                        class="w-full flex items-center gap-3 p-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md transition duration-150">
                    <i class="fas fa-sign-out-alt w-5 text-red-500"></i>
                    Sign Out
                </button>
            </div>

            <div class="text-center text-xs text-gray-400 mt-3 border-t border-gray-100 pt-2">
                Privacy Policy • Terms of Service
            </div>
        </div>
    </div>

    <!-- LOGOUT CONFIRMATION MODAL -->
    <div id="logoutConfirmModal"
         class="hidden fixed inset-0 z-[1300] bg-black bg-opacity-50 flex items-center justify-center">
        <div class="bg-white rounded-lg shadow-lg p-6 w-80 text-center">
            <h2 class="text-lg font-semibold mb-3 text-gray-800">Confirm Logout</h2>
            <p class="text-sm text-gray-600 mb-5">Are you sure you want to log out?</p>
            <div class="flex justify-center gap-4">
                <button id="confirmLogoutYes"
                        class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition">Yes, Log out</button>
                <button id="confirmLogoutCancel"
                        class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition">Cancel</button>
            </div>
        </div>
    </div>

    <!-- LOGOUT LOADING OVERLAY -->
    <div id="loadingOverlay"
         class="hidden fixed inset-0 z-[1400] bg-white bg-opacity-90 flex flex-col items-center justify-center">
        <div class="loader-spinner border-4 border-gray-300 border-t-indigo-600 rounded-full w-10 h-10 animate-spin"></div>
        <p class="mt-3 text-gray-700 font-medium">Logging out, please wait...</p>
    </div>

    <!-- MAIN CONTENT -->
    <main id="content" class="p-6">
        {% block content %}{% endblock %}
    </main>

    <script>
        const profileModal = document.getElementById('profileModal');
        const logoutBtn = document.getElementById('logoutBtn');
        const logoutModal = document.getElementById('logoutConfirmModal');
        const loadingOverlay = document.getElementById('loadingOverlay');

        function openProfileModal() {
            profileModal.classList.remove('hidden');
        }
        function closeProfileModal() {
            profileModal.classList.add('hidden');
        }

        logoutBtn.addEventListener('click', () => {
            profileModal.classList.add('hidden');
            logoutModal.classList.remove('hidden');
        });

        document.getElementById('confirmLogoutCancel').addEventListener('click', () => {
            logoutModal.classList.add('hidden');
        });

        document.getElementById('confirmLogoutYes').addEventListener('click', () => {
            logoutModal.classList.add('hidden');
            loadingOverlay.classList.remove('hidden');

            setTimeout(() => {
                window.location.href = "{% url 'users:logout_view' %}";
            }, 1500);
        });

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
